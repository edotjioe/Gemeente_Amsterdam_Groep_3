{
    "collab_server" : "",
    "contents" : "#install.packages(\"readxl\")\n#install.packages(\"dplyr\")\n#install.packages(\"stringr\")\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(stringr)\n\n\n# Loading data into R\nbbga_data <- read.csv(\"data_files/bbga_data.csv\", sep = \";\", stringsAsFactors = FALSE) \nbbga_metadata <- read_xlsx(\"data_files/bbga_additional_metadata.xlsx\", sheet = 2)\nbbga_additional <- read_xlsx(\"data_files/bbga_additional_metadata.xlsx\", sheet = 1)\n\n\n# Filtering data \nbbga_data <- bbga_data[which(bbga_data$jaar <= 2017 & bbga_data$jaar >= 2005),]\nbbga_additional <- bbga_additional[which(bbga_additional$jaar <= 2017 & bbga_additional$jaar >= 2005),]\nfacts <- bbga_data\n# Location (unique) data, niveau: 2, 4 and 8 (8 = 'Buurten')\ntemp_location_data <- unique(bbga_additional[, 1:8])\ntemp_location_data <- temp_location_data[which(temp_location_data$niveau == 2 | temp_location_data$niveau == 4 | temp_location_data$niveau == 8),]\n# Only 'location niveau; 8' and remove NA rows\ntemp_location_8 <- na.omit(temp_location_data[which(temp_location_data == 8),])\n# Only 'gebiedscode15; Buurten' \nbbga_data <- bbga_data[grep('[A-Z][0-9]{2}[a-z]', bbga_data$gebiedcode15),]\n\n\n# Loading data in statistics \nstatistics <- data.frame(\"theme_name\" = bbga_metadata$THEMA,\n                         \"statistics_variable\" = toupper(bbga_metadata$Variabele),\n                         \"statustics_unit\" = bbga_metadata$Rekeneenheid, stringsAsFactors = FALSE)\n\n# Loading data in locations\nlocations <- data.frame(\"district_code\", \n                        \"district_name\",\n                        \"quarter_code\",\n                        \"quarter_name\",\n                        \"neighbourhood_code\",\n                        \"neighbourhood_name\", stringsAsFactors = FALSE)\ncolnames(locations) <- c(\"district_code\", \"district_name\", \"quarter_code\", \"quarter_name\", \"neighbourhood_code\", \"neighbourhood_name\") \n# loop for extracting district_code and quarter_code, while also assigning the corresponding 'gebiedsnaam' \nfor(i in 1:nrow(temp_location_8)) {\n  district_code <- str_extract(temp_location_8[i,]$gebiedcode15, \"[A-Z]\")\n  quarter_code <- str_extract(temp_location_8[i,]$gebiedcode15, \"[A-Z][0-9]{2}\")\n  \n  locations[i,] <- list(\n    district_code <- district_code,\n    district_name <- temp_location_data[which(temp_location_data$gebiedcode15 == district_code),]$gebiednaam,\n    quarter_code <- quarter_code,\n    quarter_name <- temp_location_data[which(temp_location_data$gebiedcode15 == quarter_code),]$gebiednaam,\n    neighbourhood_code <- temp_location_8[i,]$gebiedcode15,\n    neighbourhood_name <- temp_location_8[i,]$gebiednaam\n  )\n}\n\n# Loading data in facts\nfacts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))\nfacts <- transform(facts, gebiedcode15 = match(facts$gebiedcode15, locations$neighbourhood_code))\nfacts$version <- 1\nfacts <- facts[, c(3, 2, 4, 1, 5)]\ncolnames(facts) <- c(\"statistics_id\", \"locations_id\", \"value\", \"year\", \"version\")",
    "created" : 1507840192837.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1783020801",
    "id" : "80CD51F9",
    "lastKnownWriteTime" : 1507893237,
    "last_content_update" : 1507893237420,
    "path" : "~/star_scheme_gemeente_amsterdam/import_data.R",
    "project_path" : "import_data.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}