addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = buurten_map2$buurt_id)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = buurten_map2$buurt_code)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = buurten_map$buurt_code)
buurten_map <- geojsonio::geojson_read("C:/Users/edotj/Documents/R/Datasets/GEBIED_BUURTEN.json",
what = "sp")
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = buurten_map$buurt_code)
library(geojsonio)
library(leaflet)
buurten_map <- geojsonio::geojson_read("C:/Users/edotj/Documents/R/Datasets/GEBIED_BUURTEN.json",
what = "sp")
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = buurten_map$Buurt_code)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
library(geojsonio)
library(leaflet)
buurten_map <- geojsonio::geojson_read("C:/Users/edotj/Documents/R/Datasets/GEBIED_BUURTEN.json",
what = "sp")
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "green",
highlightOptions = highlightOptions(color = "blue", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
shiny::runApp('~/Projects/R/Gemeente_Amsterdam_Groep_3/Gemeente Amsterdam Visuals')
av_variables_id <- unique(facts[which(facts$locations_id == location$location_id), 1])
av_variables <- statistics[av_variables_id, 3]
av_variables_id <- unique(facts[which(facts$locations_id == 1), 1])
av_variables <- statistics[1, 3]
runApp('~/Projects/R/Gemeente_Amsterdam_Groep_3/Gemeente Amsterdam Visuals')
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "blue",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
buurten_map <- geojsonio::geojson_read("C:/Users/edotj/Documents/R/Datasets/GEBIED_BUURTEN.json",
what = "sp", stringAsFactor = FALSE)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = buurten_map$Buurt)
rm(buurten)
rm(av_variables)
rm(av_variables_id)
rm(district_code)
rm(district_name)
rm(neighbourhood_code)
rm(neighbourhood_name)
rm(nycounties)
rm(i)
rm(crswgs84)
rm(quarter_code)
rm(quarter_name)
rm(topoData)
rm(buurten_map2)
locations$locations_id <- 1: nrow(locations)
View(locations)
map_fact <- c(neighbourhood = buurten_map, val = facts[locations_id == locations[neighbourhood_code == buurten_map$Buurt_code, 7], 3])
locations[neighbourhood_code == buurten_map$Buurt_code, 7]
locations[locations$neighbourhood_code == buurten_map$Buurt_code, 7]
locations[]
locations[neighbourhood_code == buurten_map$Buurt_code]
locations[neighbourhood_code == buurten_map$Buurt_code, ]
locations["neighbourhood_code" == buurten_map$Buurt_code, ]
locations["neighbourhood_code" == buurten_map["Buurt_code"], ]
locations["neighbourhood_code" == buurten_map["Buurt_code",], ]
locations["neighbourhood_code" == buurten_map["Buurt_code",], ]
buurten_map$Buurt_code
locations["neighbourhood_code" == buurten_map$Buurt_code, ]
locations[which("neighbourhood_code" == buurten_map$Buurt_code), ]
which("neighbourhood_code" == buurten_map$Buurt_code)
locations[which("neighbourhood_code" == as.character(buurten_map$Buurt_code)), ]
as.character(buurten_map$Buurt_code)
which("neighbourhood_code" == as.character(buurten_map$Buurt_code))
locations$neighbourhood_code
match(locations$neighbourhood_code, buurten_map$Buurt_code)
test <- transform(locations, match(locations$neighbourhood_code, buurten_map$Buurt_code))
test <- transform(locations, x = match(locations$neighbourhood_code, buurten_map$Buurt_code))
test >%> splice(x = match(locations$neighbourhood_code, buurten_map$Buurt_code))
library(dplyr)
test >%> splice(x = match(locations$neighbourhood_code, buurten_map$Buurt_code)))
test >%> splice(x = match(locations$neighbourhood_code, buurten_map$Buurt_code))
test %>% splice(x = match(locations$neighbourhood_code, buurten_map$Buurt_code))
test %>% slice(x = match(locations$neighbourhood_code, buurten_map$Buurt_code))
locations %>% slice(match(locations$neighbourhood_code, buurten_map$Buurt_code))
rm(test)
locations %>% slice(match(locations$neighbourhood_code, buurten_map$Buurt_code))
View(locations)
View(locations)
locations %>% slice(match(buurten_map$Buurt_code, locations$neighbourhood_code))
View(locations)
View(locations)
locations <- locations %>% slice(match(buurten_map$Buurt_code, locations$neighbourhood_code))
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
library(leaflet)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 1, smoothFactor = 1, fillOpacity = 0.5, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.5, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
map_fact <- c(neighbourhood = buurten_map, val = facts[statistics_id == 1 & year == 2017, 3])
map_fact <- c(neighbourhood = buurten_map, val = facts["statistics_id" == 1 & "year" == 2017, 3])
map_fact <- c(neighbourhood = buurten_map$Buurt_code, val = facts["statistics_id" == 1 & "year" == 2017, 3])
map_fact <- data.frame(neighbourhood = buurten_map$Buurt_code, val = facts["statistics_id" == 1 & "year" == 2017, 3])
facts["statistics_id" == 1 & "year" == 2017, 3]
View(statistics)
View(statistics)
facts$statistics_id <- 1 : nrow(facts)
facts["statistics_id" == 1 & "year" == 2017, 3]
# Loading data in facts
facts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))
facts <- transform(facts, gebiedcode15 = match(facts$gebiedcode15, locations$neighbourhood_code))
facts$version <- 1
facts <- facts[, c(3, 2, 4, 1, 5)]
colnames(facts) <- c("statistics_id", "locations_id", "value", "year", "version")
View(statistics)
View(statistics)
statistics$statistics_id <- 1 : nrow(statistics)
facts["statistics_id" == 1 & "year" == 2017, 3]
map_fact <- data.frame(neighbourhood = buurten_map$Buurt_code, val = facts["year" == 2017, 3])
facts["year" == 2017, 3]
facts["year" == 2017, 3]
facts[which("year" == 2017), 3]
facts[which(facts$year == 2017), 3]
facts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))
#install.packages("readxl")
#install.packages("dplyr")
#install.packages("stringr")
library(readxl)
library(dplyr)
library(stringr)
# Loading data into R
bbga_data <- read.csv("data_files/bbga_data.csv", sep = ";", stringsAsFactors = FALSE)
bbga_metadata <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 2)
bbga_additional <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 1)
# Filtering data
bbga_data <- bbga_data[which(bbga_data$jaar <= 2017 & bbga_data$jaar >= 2005),]
bbga_additional <- bbga_additional[which(bbga_additional$jaar <= 2017 & bbga_additional$jaar >= 2005),]
facts <- bbga_data
# Location (unique) data, niveau: 2, 4 and 8 (8 = 'Buurten')
temp_location_data <- unique(bbga_additional[, 1:8])
temp_location_data <- temp_location_data[which(temp_location_data$niveau == 2 | temp_location_data$niveau == 4 | temp_location_data$niveau == 8),]
# Only 'location niveau; 8' and remove NA rows
temp_location_8 <- na.omit(temp_location_data[which(temp_location_data == 8),])
# Only 'gebiedscode15; Buurten'
bbga_data <- bbga_data[grep('[A-Z][0-9]{2}[a-z]', bbga_data$gebiedcode15),]
# Loading data in statistics
statistics <- data.frame("theme_name" = bbga_metadata$THEMA,
"statistics_variable" = toupper(bbga_metadata$Variabele),
"statustics_unit" = bbga_metadata$Rekeneenheid, stringsAsFactors = FALSE)
# Loading data in locations
locations <- data.frame("district_code",
"district_name",
"quarter_code",
"quarter_name",
"neighbourhood_code",
"neighbourhood_name", stringsAsFactors = FALSE)
colnames(locations) <- c("district_code", "district_name", "quarter_code", "quarter_name", "neighbourhood_code", "neighbourhood_name")
# loop for extracting district_code and quarter_code, while also assigning the corresponding 'gebiedsnaam'
for(i in 1:nrow(temp_location_8)) {
district_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z]")
quarter_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z][0-9]{2}")
locations[i,] <- list(
district_code <- district_code,
district_name <- temp_location_data[which(temp_location_data$gebiedcode15 == district_code),]$gebiednaam,
quarter_code <- quarter_code,
quarter_name <- temp_location_data[which(temp_location_data$gebiedcode15 == quarter_code),]$gebiednaam,
neighbourhood_code <- temp_location_8[i,]$gebiedcode15,
neighbourhood_name <- temp_location_8[i,]$gebiednaam
)
}
locations$locations_id <- 1: nrow(locations)
statistics$statistics_id <- 1 : nrow(statistics)
# Loading data in facts
facts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))
facts <- transform(facts, gebiedcode15 = match(facts$gebiedcode15, locations$neighbourhood_code))
facts$version <- 1
facts <- facts[, c(3, 2, 4, 1, 5)]
colnames(facts) <- c("statistics_id", "locations_id", "value", "year", "version")
facts[which(facts$year == 2017), 3]
facts[which(facts$year == 2017 & facts$statistics_id == 1), 3]
#install.packages("readxl")
#install.packages("dplyr")
#install.packages("stringr")
library(readxl)
library(dplyr)
library(stringr)
# Loading data into R
bbga_data <- read.csv("data_files/bbga_data.csv", sep = ";", stringsAsFactors = FALSE)
bbga_metadata <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 2)
bbga_additional <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 1)
# Filtering data
bbga_data <- bbga_data[which(bbga_data$jaar <= 2017 & bbga_data$jaar >= 2005),]
bbga_additional <- bbga_additional[which(bbga_additional$jaar <= 2017 & bbga_additional$jaar >= 2005),]
facts <- bbga_data
# Location (unique) data, niveau: 2, 4 and 8 (8 = 'Buurten')
temp_location_data <- unique(bbga_additional[, 1:8])
temp_location_data <- temp_location_data[which(temp_location_data$niveau == 2 | temp_location_data$niveau == 4 | temp_location_data$niveau == 8),]
# Only 'location niveau; 8' and remove NA rows
temp_location_8 <- na.omit(temp_location_data[which(temp_location_data == 8),])
# Only 'gebiedscode15; Buurten'
facts <- facts[grep('[A-Z][0-9]{2}[a-z]', facts$gebiedcode15),]
# Loading data in statistics
statistics <- data.frame("theme_name" = bbga_metadata$THEMA,
"statistics_variable" = toupper(bbga_metadata$Variabele),
"statustics_unit" = bbga_metadata$Rekeneenheid, stringsAsFactors = FALSE)
# Loading data in locations
locations <- data.frame("district_code",
"district_name",
"quarter_code",
"quarter_name",
"neighbourhood_code",
"neighbourhood_name", stringsAsFactors = FALSE)
colnames(locations) <- c("district_code", "district_name", "quarter_code", "quarter_name", "neighbourhood_code", "neighbourhood_name")
# loop for extracting district_code and quarter_code, while also assigning the corresponding 'gebiedsnaam'
for(i in 1:nrow(temp_location_8)) {
district_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z]")
quarter_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z][0-9]{2}")
locations[i,] <- list(
district_code <- district_code,
district_name <- temp_location_data[which(temp_location_data$gebiedcode15 == district_code),]$gebiednaam,
quarter_code <- quarter_code,
quarter_name <- temp_location_data[which(temp_location_data$gebiedcode15 == quarter_code),]$gebiednaam,
neighbourhood_code <- temp_location_8[i,]$gebiedcode15,
neighbourhood_name <- temp_location_8[i,]$gebiednaam
)
}
locations$locations_id <- 1: nrow(locations)
statistics$statistics_id <- 1 : nrow(statistics)
# Loading data in facts
facts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))
facts <- transform(facts, gebiedcode15 = match(facts$gebiedcode15, locations$neighbourhood_code))
facts$version <- 1
facts <- facts[, c(3, 2, 4, 1, 5)]
colnames(facts) <- c("statistics_id", "locations_id", "value", "year", "version")
facts[which(facts$year == 2017 & facts$statistics_id == 1), 3]
map_fact <- data.frame(neighbourhood = buurten_map$Buurt_code, val = facts[which(facts$statistics_id == 1 & facts$year == 2017), 3])
facts <- complete.cases(facts)
#install.packages("readxl")
#install.packages("dplyr")
#install.packages("stringr")
library(readxl)
library(dplyr)
library(stringr)
# Loading data into R
bbga_data <- read.csv("data_files/bbga_data.csv", sep = ";", stringsAsFactors = FALSE)
bbga_metadata <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 2)
bbga_additional <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 1)
# Filtering data
bbga_data <- bbga_data[which(bbga_data$jaar <= 2017 & bbga_data$jaar >= 2005),]
bbga_additional <- bbga_additional[which(bbga_additional$jaar <= 2017 & bbga_additional$jaar >= 2005),]
facts <- bbga_data
# Location (unique) data, niveau: 2, 4 and 8 (8 = 'Buurten')
temp_location_data <- unique(bbga_additional[, 1:8])
temp_location_data <- temp_location_data[which(temp_location_data$niveau == 2 | temp_location_data$niveau == 4 | temp_location_data$niveau == 8),]
# Only 'location niveau; 8' and remove NA rows
temp_location_8 <- na.omit(temp_location_data[which(temp_location_data == 8),])
# Only 'gebiedscode15; Buurten'
facts <- facts[grep('[A-Z][0-9]{2}[a-z]', facts$gebiedcode15),]
# Loading data in statistics
statistics <- data.frame("theme_name" = bbga_metadata$THEMA,
"statistics_variable" = toupper(bbga_metadata$Variabele),
"statustics_unit" = bbga_metadata$Rekeneenheid, stringsAsFactors = FALSE)
# Loading data in locations
locations <- data.frame("district_code",
"district_name",
"quarter_code",
"quarter_name",
"neighbourhood_code",
"neighbourhood_name", stringsAsFactors = FALSE)
colnames(locations) <- c("district_code", "district_name", "quarter_code", "quarter_name", "neighbourhood_code", "neighbourhood_name")
# loop for extracting district_code and quarter_code, while also assigning the corresponding 'gebiedsnaam'
for(i in 1:nrow(temp_location_8)) {
district_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z]")
quarter_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z][0-9]{2}")
locations[i,] <- list(
district_code <- district_code,
district_name <- temp_location_data[which(temp_location_data$gebiedcode15 == district_code),]$gebiednaam,
quarter_code <- quarter_code,
quarter_name <- temp_location_data[which(temp_location_data$gebiedcode15 == quarter_code),]$gebiednaam,
neighbourhood_code <- temp_location_8[i,]$gebiedcode15,
neighbourhood_name <- temp_location_8[i,]$gebiednaam
)
}
locations$locations_id <- 1: nrow(locations)
statistics$statistics_id <- 1 : nrow(statistics)
# Loading data in facts
facts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))
facts <- transform(facts, gebiedcode15 = match(facts$gebiedcode15, locations$neighbourhood_code))
facts$version <- 1
facts <- facts[, c(3, 2, 4, 1, 5)]
colnames(facts) <- c("statistics_id", "locations_id", "value", "year", "version")
facts <- facts[complete.cases(facts), ]
facts[which(facts$year == 2017 & facts$statistics_id == 1), 3]
facts[which(facts$year == 2016 & facts$statistics_id == 1), 3]
facts[which(facts$year == 2016 & facts$statistics_id == 1), c(3, 7)]
facts[which(facts$year == 2016 & facts$statistics_id == 1), 3:7]
facts[which(facts$year == 2016 & facts$statistics_id == 1), 3]
facts[which(facts$year == 2016 & facts$statistics_id == 1), ]
map_fact <-
?match
map_fact <-
?match()
?match()
temp <- facts[which(facts$year == 2016 & facts$statistics_id == 1), ]
map_fact <- data.frame(locations, temp[match(locations$locations_id, temp$locations_id), ])
View(map_fact)
View(map_fact)
temp <- facts[which(facts$year == 2016 & facts$statistics_id == 1), ]
map_fact <- data.frame(locations, temp[match(locations$locations_id, temp$locations_id), "value"])
View(map_fact)
View(map_fact)
temp <- facts[which(facts$year == 2016 & facts$statistics_id == 1), ]
map_fact <- data.frame(locations, value = temp[match(locations$locations_id, temp$locations_id), "value"])
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.5, color = "red", fill = map_fact$value,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 1, color = "red", fill = map_fact$value,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 1, color = "red", color = map_fact$value,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 1, color = "red", fill = map_fact$value,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.5, color = "red", fill = map_fact$value,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.7, color = "red", fill = map_fact$value,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.7, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = map_fact$value, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = locations$neighbourhood_name)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.7, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = paste(locations$neighbourhood_name))
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.7, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = paste(locations$neighbourhood_name, " - "))
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE, weight = 2, smoothFactor = 1, fillOpacity = 0.7, color = "red",
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = paste(locations$neighbourhood_name, " - ", map_fact$value))
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE,
weight = 2,
smoothFactor = 1,
fillOpacity = 0.7,
color = "red",
highlightOptions = highlightOptions(color = "white",
weight = 3,
bringToFront = TRUE),
label = paste(locations$neighbourhood_name, " - ", map_fact$value))
temp <- facts[which(facts$year == 2017 & facts$statistics_id == 1), ]
map_fact <- data.frame(locations, value = temp[match(locations$locations_id, temp$locations_id), "value"])
map_fact <- data.frame(locations, value = temp[match(locations$locations_id, temp$locations_id), "value"])
pal <- colorNumeric("viridis", NULL)
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE,
weight = 2,
smoothFactor = 1,
fillOpacity = 0.7,
color = "red",
highlightOptions = highlightOptions(color = "white",
weight = 3,
bringToFront = TRUE,
fillColor = ~pal(log10(map_fact$value))),
label = paste(locations$neighbourhood_name, " - ", map_fact$value))
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE,
weight = 2,
smoothFactor = 1,
fillOpacity = 0.7,
color = "red",
fillColor = ~pal(log10(map_fact$value)),
highlightOptions = highlightOptions(color = "white",
weight = 3,
bringToFront = TRUE),
label = paste(locations$neighbourhood_name, " - ", map_fact$value))
leaflet(data = buurten_map) %>%
addTiles() %>%
addPolygons(stroke = TRUE,
weight = 2,
smoothFactor = 1,
fillOpacity = 0.7,
color = "red",
fillColor = ~pal(log10(map_fact$value)),
highlightOptions = highlightOptions(color = "white",
weight = 3,
bringToFront = TRUE),
label = paste(locations$neighbourhood_name, " - ", map_fact$value)) %>%
addLegend(pal = pal, values = ~log10(map_fact$value), opacity = 1.0,
labFormat = labelFormat(transform = function(x) round(10^x)))
install.packages("readxl")
install.packages("dplyr")
install.packages("stringr")
library(readxl)
library(dplyr)
library(stringr)
# Loading data into R
bbga_data <- read.csv("data_files/bbga_data.csv", sep = ";", stringsAsFactors = FALSE)
bbga_metadata <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 2)
bbga_additional <- read_xlsx("data_files/bbga_additional_metadata.xlsx", sheet = 1)
# Filtering data
bbga_data <- bbga_data[which(bbga_data$jaar <= 2017 & bbga_data$jaar >= 2005),]
bbga_additional <- bbga_additional[which(bbga_additional$jaar <= 2017 & bbga_additional$jaar >= 2005),]
facts <- bbga_data
# Location (unique) data, niveau: 2, 4 and 8 (8 = 'Buurten')
temp_location_data <- unique(bbga_additional[, 1:8])
temp_location_data <- temp_location_data[which(temp_location_data$niveau == 2 | temp_location_data$niveau == 4 | temp_location_data$niveau == 8),]
# Only 'location niveau; 8' and remove NA rows
temp_location_8 <- na.omit(temp_location_data[which(temp_location_data == 8),])
# Only 'gebiedscode15; Buurten'
facts <- facts[grep('[A-Z][0-9]{2}[a-z]', facts$gebiedcode15),]
# Loading data in statistics
statistics <- data.frame("theme_name" = bbga_metadata$THEMA,
"statistics_variable" = toupper(bbga_metadata$Variabele),
"statustics_unit" = bbga_metadata$Rekeneenheid, stringsAsFactors = FALSE)
# Loading data in locations
locations <- data.frame("district_code",
"district_name",
"quarter_code",
"quarter_name",
"neighbourhood_code",
"neighbourhood_name", stringsAsFactors = FALSE)
colnames(locations) <- c("district_code", "district_name", "quarter_code", "quarter_name", "neighbourhood_code", "neighbourhood_name")
# loop for extracting district_code and quarter_code, while also assigning the corresponding 'gebiedsnaam'
for(i in 1:nrow(temp_location_8)) {
district_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z]")
quarter_code <- str_extract(temp_location_8[i,]$gebiedcode15, "[A-Z][0-9]{2}")
locations[i,] <- list(
district_code <- district_code,
district_name <- temp_location_data[which(temp_location_data$gebiedcode15 == district_code),]$gebiednaam,
quarter_code <- quarter_code,
quarter_name <- temp_location_data[which(temp_location_data$gebiedcode15 == quarter_code),]$gebiednaam,
neighbourhood_code <- temp_location_8[i,]$gebiedcode15,
neighbourhood_name <- temp_location_8[i,]$gebiednaam
)
}
locations$locations_id <- 1: nrow(locations)
statistics$statistics_id <- 1 : nrow(statistics)
# Loading data in facts
facts <- transform(facts, variabele = match(facts$variabele, statistics$statistics_variable))
facts <- transform(facts, gebiedcode15 = match(facts$gebiedcode15, locations$neighbourhood_code))
facts$version <- 1
facts <- facts[, c(3, 2, 4, 1, 5)]
colnames(facts) <- c("statistics_id", "locations_id", "value", "year", "version")
facts <- facts[complete.cases(facts), ]
